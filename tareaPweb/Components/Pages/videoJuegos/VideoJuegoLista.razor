@page "/videojuegos"
@using System.ComponentModel.DataAnnotations
@using tareaPweb.Data
@using tareaPweb.models
@using Microsoft.EntityFrameworkCore
@inject AppDbContext context

@inject NavigationManager NavigationManager
@rendermode InteractiveServer

<h3>Lista de Videojuegos</h3>

<button class="btn btn-success mb-3" @onclick="AgregarVideojuego">Agregar Videojuego</button>

<table class="table table-striped">
    <thead>
        <tr>
            <th>Nombre</th>
            <th>Imagen Portada</th>
            <th>Desarrollador</th>
            <th>Plataforma</th>
            <th>Género</th>
            <th>Fecha de Lanzamiento</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var videojuego in listaVideojuegos)
        {
            <tr>
                <td>@videojuego.Nombre</td>
                @if (!string.IsNullOrEmpty(videojuego.ImagenPortada))
                {
                    <td><img src="@videojuego.ImagenPortada" alt="@videojuego.Nombre" class="img-thumbnail"
                            style="width: 70px; height: 70px;" /></td>
                }
                else
                {
                    <td>
                    <td><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRmNILEZppKJCs1LHgBaUGbbFzQJsv6b5bt-w&s"
                            alt="@videojuego.Nombre" class="img-thumbnail" style="width: 70px; height: 70px;" /></td>
                    </td>
                }

                <td>@videojuego.Desarrollador</td>
                <td>@videojuego.Plataforma.Nombre</td>
                <td>@videojuego.Genero</td>
                <td>@videojuego.FechaLanzamiento.ToShortDateString()</td>
                <td>
                    <button class="btn btn-primary btn-sm" @onclick="() => EditarVideojuego(videojuego)">Editar</button>
                    <button class="btn btn-info btn-sm" @onclick="() => VerDetalles(videojuego)">Detalles</button>
                    <button class="btn btn-danger btn-sm" @onclick="() => EliminarVideojuego(videojuego)">Eliminar</button>
                </td>
            </tr>
        }
    </tbody>
</table>
@code {
    // Lista de videojuegos (puedes llenarla con datos reales)
    private List<VideoJuegos> listaVideojuegos = new List<VideoJuegos>();

    protected override async Task OnInitializedAsync()
    {
        listaVideojuegos = await context.Videojuegos.ToListAsync();
    }

    private void AgregarVideojuego()
    {
        // Navega a la página de agregar videojuegosVideoJuegos
        NavigationManager.NavigateTo("/videojuego-form");
    }

    private void EditarVideojuego(VideoJuegos videojuegosVideoJuegos)
    {
        // Navega a la página de edición con el videojuegosVideoJuegos seleccionado
        NavigationManager.NavigateTo($"/videojuego-form/{videojuegosVideoJuegos.VideoJuegoId}");
    }

    private void VerDetalles(VideoJuegos videojuegosVideoJuegos)
    {
        // Navega a la página de detalles del videojuegosVideoJuegos
        NavigationManager.NavigateTo($"/videojuegos-detalles/{videojuegosVideoJuegos.VideoJuegoId}");
    }

    private void EliminarVideojuego(VideoJuegos videojuego)
    {
        context.Videojuegos.Remove(videojuego);
        context.SaveChanges();
        listaVideojuegos = context.Videojuegos.ToList();
    }
}